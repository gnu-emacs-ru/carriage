#+title: Context Menu Keys v3 — Stable mnemonics (bindings + UI)
#+author: Carriage Team
#+language: en
#+options: toc:2 num:t
#+property: header-args :results silent

Meta
- Spec-ID: carriage/ui/context-menu-keys/v3
- Version: v3.0
- Status: draft
- Normativity: RFC 2119 applies
- Ownership: ui, keyspec
- Prompt-ABI: v1
- Pack-Profiles: P2-full
- Precedence: Security > Errors > Formats > Interfaces > Algorithms > UI
- RAG-Indexing: on
- Fingerprint: <auto>

Purpose
- Define stable mnemonic suffix sequences for context controls inside the Carriage prefix-map.
- Define UI expectations for menu providers (transient/hydra) without making UI keys the source of bindings.

Scope
- In scope:
  - stable suffix key sequences under the Carriage prefix-map
  - grouping/labels expectations for menus (Context section/column)
- Out of scope:
  - how context is collected and applied in requests (see context specs)

Normative Requirements
- REQ-cm-001 (Bindings-first):
  - The following mnemonics MUST be available as real bindings in `carriage-prefix-map`
    (i.e., they work without any menu UI).

- REQ-cm-002 (Menu is optional):
  - A menu provider MAY render these actions as a dedicated Context group/column.
  - Disabling the menu provider MUST NOT affect these bindings.

- REQ-cm-003 (No postfix key hints in labels):
  - Labels must not append bracketed key hints like "[t g]" (UI already shows keys).

Frozen mnemonic mapping (real bindings inside prefix-map)
- t g — Toggle gptel context (gptel)
- t f — Toggle document files (files)
- t p — Toggle applied patch files (patched)
- t m — Toggle Project Map (map)
- t v — Toggle visible buffers (visible)
- t a — Doc scope: All begin_context (all)
- t l — Doc scope: Last/nearest begin_context (last)
- t s — Doc scope: Cycle All ↔ Last (scope)
- t P — Context profile P1/P3 (profile)

Additional prefix-map invariants
- INV-cm-001:
  - "t" MUST be a prefix key within `carriage-prefix-map` (not a command).
- INV-cm-002:
  - The full key sequence is the uniqueness key ("t g" distinct from "g").

Menu UI expectations (provider-dependent, non-binding)
- UI-cm-001:
  - A menu provider SHOULD group context actions into a dedicated group/column named "Context".
- UI-cm-002:
  - A menu provider MAY implement a two-stroke interaction model for Context actions.
  - This is UI-only and MUST NOT replace/override the real prefix-map bindings.

Testing and Conformance
- TST-cm-001:
  - `carriage-prefix-map` binds all sequences listed above.
  - `lookup-key` for "t" returns a keymap.
- TST-cm-002:
  - keyspec action labels for these actions are non-empty and contain no trailing bracket hints.

Cross-References
- spec/keyspec-v2.org (Keyspec v3 in this repo)
- spec/ui-v2.org
- Code: lisp/carriage-keyspec.el
